# Задание 5
## Петрова Ксения Вариант 16
### Описание задания 

16. Задача о картинной галерее. Вахтер следит за тем, чтобы в картинной галерее одновременно было не более 50 посетителей. Для обозрения
представлены 5 картин. Посетитель ходит от картины к картине, и если на картину любуются более чем десять посетителей, он стоит в стороне и ждет, пока число желающих увидеть картину не станет меньше. Посетитель может покинуть галерею. Создать многопоточное приложение, моделирующее работу картинной галереи.

### Запуск

Обязательное количество аргументов: 4.

Первый — название файла для вывода. Будет перезаписан или создан.

Второй — количество посетителей, которые хотят посетить выставку. Именно столько потоков будет создано, которые сначала будут пытаться попасть на выставку, а потом — успеть к картине, пока ее еще не успели окружить.

Третий — максимальное количество посетителей выставки в конкретный момент. 

Четвертый — количество картин на выставке, среди которых будет выбирать посетители.

В файл будет выгружаться полное логирование: на какую картину сейчас смотрит какой посетитель, кто попал и кто ушел с выставки.

### Программа 

В своей задаче я использую модель Взаимодействующие равные.
Потоками выступают посетители выставки, которые хотят попасть на выставку, а затем посмотреть конкретную картину на ней.
Создается объект Gallery, в котором создается vector std::atomic<int> pictures. Здесь я поддерживаю количество смотрящих конкретную картину в данный момент времени. std::atomic используется, чтобы не было data-race. Также у объекта Gallery есть поле currently типа std::atomic<int>. Так я поддерживаю количество посетителей в данный момент времени на выставке, чтобы не было переполнения галереи.

Затем создаются потоки юзеров. В функцию run() внутри него передается ссылка на объект gallery, общий для всех. Каждый из них жаждет попасть на выставку — то есть ждет момента, пока currently в переданном объекте gallery будет меньше заданного количества. После попадания на выставку, посетитель выбирает картину, которую хочет посмотреть — генерируется рандомное число r от 0 до заданного количества картин - 1. Если картину уже все обступили, посетитель начинает ждать, пока освободится место. Чтобы понять, обступили картину или нет, смотрится значение в pictures[r] и в цикле ждем, пока оно станет меньше максимального. Всего пользователь обходит 5 картин (5 раз выбирает, к какой картине пойти и посмотреть), затем уходит с выставки, освобождая место (уменьшая значние currently на 1).

Для реализации общих среди всех потоков переменных (например, количество посетителей, которые смотрят конкретную картину или общее количество посетителей на выставки) я использую std::atomic. Он позволяет избежать data-race и deadlock’ов с помощью методов load(), fetch_add(), fetch_sub().
Для реализации потоков-посетителей использую классический std::thread.
